<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Registrar entrada</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

    <div class="container py-5">
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">Registrar entrada de inventario</h4>
            </div>

            <div class="card-body">
                <form method="post">
                    {% csrf_token %}

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="id_producto" class="form-label">Producto</label>
                            {{ form.producto}}
                        </div>

                        <div class="col-md-6">
                            <label for="id_proveedor" class="form-label">Proveedor</label>
                            <select name="proveedor" id="id_proveedor" class="form-select">
                                <option value="">-- Seleccione un proveedor --</option>
                                {% for p in proveedores %}
                                <option value="{{ p.id }}">{{ p.nombre_empresa }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="id_cantidad" class="form-label">Cantidad</label>
                            {{ form.cantidad }}
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Precio unitario</label>
                            <input type="text" id="precio_unitario" class="form-control"
                                placeholder="Se llena automÃ¡ticamente" readonly>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Fecha</label>
                            <input type="text" class="form-control" value="{{ now|date:'d/m/Y H:i' }}" readonly>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="id_observaciones" class="form-label">Observaciones</label>
                        {{ form.observaciones }}
                    </div>

                    <div class="text-end">
                        <a href="{% url 'inventario:lista' %}" class="btn btn-secondary">Cancelar</a>
                        <button type="submit" class="btn btn-primary">Guardar entrada</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="text/template" id="productos-data">
    {
        {% for prod in form.fields.producto.queryset %}
            "{{ prod.id }}": "{{ prod.precio_unitario|escapejs }}"{% if not forloop.last %},{% endif %}
        {% endfor %}
    }
</script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const productoSelect = document.getElementById("id_producto");
            const precioInput = document.getElementById("precio_unitario");

            // Lee el contenido del script anterior y lo convierte a objeto JS
            const productos = JSON.parse(document.getElementById("productos-data").textContent);

            productoSelect.addEventListener("change", function () {
                precioInput.value = productos[this.value] || "";
            });
        });
    </script>
</body>

</html>